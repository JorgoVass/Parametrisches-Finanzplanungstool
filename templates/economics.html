{% extends "base.html" %}
{% block title %}Wirtschaftlichkeit{% endblock %}
{% block content %}

<div class="container">
  <h2>💶 Wirtschaftlichkeit: Implantat vs. konservativ</h2>

  <form method="post" class="form-box">
    <h3>Allgemein</h3>
    <label>Zeitraum (Jahre)</label>
    <input type="number" name="time_horizon_years" min="1" value="{{ params.time_horizon_years }}">
    <div class="help">Über wie viele Jahre du vergleichst (z. B. 10).</div>

    <label>Diskontsatz (z. B. 0.03)</label>
    <input type="number" step="0.001" name="discount_rate" value="{{ params.discount_rate }}">
    <div class="help">„Zinsfaktor“ für Barwert: zukünftige Kosten auf heute abgezinst.</div>

    <label>Erstattung OP (0–1)</label>
    <input type="number" step="0.01" name="reimb_rate_surgery" value="{{ params.reimb_rate_surgery }}">

    <label>Erstattung konservativ (0–1)</label>
    <input type="number" step="0.01" name="reimb_rate_conservative" value="{{ params.reimb_rate_conservative }}">

    <label>Patienten-Zuzahlung/Tag (€)</label>
    <input type="number" step="0.01" name="patient_copay_flat" value="{{ params.patient_copay_flat }}">

    <h3>Implantat & Nachsorge</h3>
    <label>Implantatpreis (Sachkosten) €</label>
    <input type="number" step="0.01" name="implant_unit_cost" value="{{ params.implant_unit_cost }}">
    <label>Lebensdauer (Jahre)</label>
    <input type="number" name="device_lifetime_years" value="{{ params.device_lifetime_years }}">
    <label>Nachsorge/Jahr</label>
    <input type="number" name="followup_per_year" value="{{ params.followup_per_year }}">
    <label>Kosten je Nachsorge (€)</label>
    <input type="number" step="0.01" name="followup_cost_each" value="{{ params.followup_cost_each }}">
    <label>Komplikations-Wahrscheinlichkeit (0–1)</label>
    <input type="number" step="0.001" name="complication_prob" value="{{ params.complication_prob }}">
    <label>Komplikationskosten (€)</label>
    <input type="number" step="0.01" name="complication_cost" value="{{ params.complication_cost }}">

    <h3>OP-Kosten</h3>
    <label>OP-Zeit (Minuten)</label>
    <input type="number" name="or_time_min" value="{{ params.or_time_min }}">
    <label>OP-Kosten pro Minute (€)</label>
    <input type="number" step="0.01" name="or_cost_per_min" value="{{ params.or_cost_per_min }}">
    <label>Chirurg (€)</label>
    <input type="number" step="0.01" name="surgeon_fee" value="{{ params.surgeon_fee }}">
    <label>Anästhesie (€)</label>
    <input type="number" step="0.01" name="anesthesia_fee" value="{{ params.anesthesia_fee }}">
    <label>DRG/Fallpauschale (€)</label>
    <input type="number" step="0.01" name="hospital_case_fee" value="{{ params.hospital_case_fee }}">
    <label>Verbrauchsmaterial (€)</label>
    <input type="number" step="0.01" name="consumables_cost" value="{{ params.consumables_cost }}">
    <label>Post-OP Tage</label>
    <input type="number" name="post_op_days" value="{{ params.post_op_days }}">
    <label>Post-OP €/Tag</label>
    <input type="number" step="0.01" name="post_op_daily_cost" value="{{ params.post_op_daily_cost }}">

    <h3>Konservative Lösung (jährlich)</h3>
    <label>Monatsbedarf (€)</label>
    <input type="number" step="0.01" name="monthly_supplies_cost" value="{{ params.monthly_supplies_cost }}">
    <label>Pflegezeit/Monat (€)</label>
    <input type="number" step="0.01" name="monthly_care_time_cost" value="{{ params.monthly_care_time_cost }}">
    <label>Komplikationen/Jahr (€)</label>
    <input type="number" step="0.01" name="annual_complication_cost_conservative" value="{{ params.annual_complication_cost_conservative }}">

    <h3>Start-up</h3>
    <label>Verkaufspreis (€)</label>
    <input type="number" step="0.01" name="selling_price_implant" value="{{ params.selling_price_implant }}">
    <label>COGS (€)</label>
    <input type="number" step="0.01" name="cogs_implant" value="{{ params.cogs_implant }}">
    <label>Vertriebskosten/Fall (€)</label>
    <input type="number" step="0.01" name="sales_cost_per_case" value="{{ params.sales_cost_per_case }}">
    <label>Overhead/Jahr (€)</label>
    <input type="number" step="0.01" name="overhead_per_year" value="{{ params.overhead_per_year }}">

    <button type="submit" class="modern-button">Berechnen</button>
  </form>
</div>

{% if plot_html %}
  <div class="container">
    <h3>Gesamtkosten (kumuliert, jährlich)</h3>
    <div class="plot-box">{{ plot_html|safe }}</div>

    <div class="results-box" style="margin-top:20px;">
      {% if breakeven_year is not none %}
        ✅ Break-Even gegenüber konservativ in Jahr: <strong>{{ breakeven_year }}</strong><br>
      {% else %}
        ❌ Kein Break-Even im Betrachtungszeitraum<br>
      {% endif %}
      <br>
      <b>Start-up</b><br>
      Unit-Marge: <b>{{ "%.0f"|format(startup.unit_margin) }} €</b><br>
      Break-even-Stückzahl/Jahr: <b>{{ startup.breakeven_units }}</b>
    </div>

    <div class="nav-links">
      <a href="{{ url_for('home') }}" class="button-link">⏎ Zurück zur Startseite</a>
    </div>
  </div>
{% endif %}

<style>
  .form-box { display:grid; gap:12px; }
  .form-box h3 { margin-top:10px; color:#4B0082; }
  .form-box label { font-weight:bold; color:#333; }
  .form-box input { width:100%; padding:8px; border:1px solid #CCC; border-radius:4px; background-color:#F0F0FF; }
  .help { font-size:13px; color:#555; margin-top:-6px; margin-bottom:8px; }
  .plot-box { margin-top:20px; border:1px solid #DDD; padding:10px; border-radius:8px; background-color:#FAFAFA; }
  .results-box { background-color:#F3F3FF; padding:20px; border-radius:8px; font-size:16px; color:#333; line-height:1.6; }
</style>
{% endblock %}
