{% extends "base.html" %}
{% block title %}Monatsdaten{% endblock %}

{% block content %}
<div class="container">
  <h2>Übersicht der Monatsdaten</h2>

  <!-- Jahr-Filter -->
  <form method="get" action="{{ url_for('monatsdaten') }}" style="margin-bottom: 25px; text-align: center;">
    <label style="font-weight: 600; margin-right: 10px;">Jahr anzeigen:</label>
    <select name="jahr" class="jahr-select" onchange="this.form.submit()">
      <option value="alle" {% if jahr_auswahl == 'alle' %}selected{% endif %}>Alle Jahre</option>
      {% for y in jahre %}
        <option value="{{ y }}" {% if y|string == jahr_auswahl|string %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>
  </form>

  <table class="data-table">
    <thead>
      <tr>
        <th>Monat</th>
        <th>Jahr</th>
        <th>Umsatz (€)</th>
        <th>Kosten (€)</th>
        <th>Gewinn (€)</th>
        <th>Aktion</th>
      </tr>
    </thead>
    <tbody>
      {% for e in daten %}
      <tr>
        <td>{{ e.monat }}</td>
        <td><strong>{{ e.jahr }}</strong></td>
        <td>{{ "{:,.2f}".format(e.revenue_calc) }}</td>
        <td>{{ "{:,.2f}".format(e.costs_calc) }}</td>
        <td style="font-weight:600; color: {{ 'green' if e.profit_calc >= 0 else 'red' }};">
          {{ "{:+,.2f}".format(e.profit_calc) }}
        </td>
        <td>
          <a href="{{ url_for('bearbeiten', monat=e.monat, jahr=e.jahr) }}" class="edit-button">Bearbeiten</a>
        </td>
      </tr>
      {% endfor %}
      {% if daten|length == 0 %}
      <tr>
        <td colspan="6" style="padding:20px; color:#999; text-align: center;">
          {% if jahr_auswahl != 'alle' %}
            Keine Daten für {{ jahr_auswahl }} vorhanden.
          {% else %}
            Keine Daten vorhanden.
          {% endif %}
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <!-- Statistik-Box (optional) -->
  {% if daten|length > 0 %}
  <div class="stats-box">
    <h3>Statistik ({{ jahr_auswahl if jahr_auswahl != 'alle' else 'Gesamt' }})</h3>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-label">Einträge</div>
        <div class="stat-value">{{ daten|length }}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Gesamt-Umsatz</div>
        <div class="stat-value">{{ "{:,.2f}".format(daten|sum(attribute='revenue_calc')) }} €</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Gesamt-Kosten</div>
        <div class="stat-value">{{ "{:,.2f}".format(daten|sum(attribute='costs_calc')) }} €</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Gesamt-Gewinn</div>
        <div class="stat-value" style="color: {{ 'green' if daten|sum(attribute='profit_calc') >= 0 else 'red' }};">
          {{ "{:+,.2f}".format(daten|sum(attribute='profit_calc')) }} €
        </div>
      </div>
    </div>
  </div>
  {% endif %}

    <div class="nav-links">
      <a href="{{ url_for('export_csv', jahr=jahr_auswahl) }}" class="button-link export-button">
        Als CSV exportieren
      </a>
      <a href="{{ url_for('home') }}" class="button-link">Zurück zur Startseite</a>
      <a href="{{ url_for('diagramm') }}" class="button-link">Zum Diagramm</a>
</div>

<style>
  .export-button {
    background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  }
  
  .export-button:hover {
    background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
  }
</style>
<style>
  .container {
    max-width: 1000px;
    margin: auto;
    padding: 30px;
    background-color: #FFFFFF;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-radius: 12px;
  }
  
  h2 {
    text-align: center;
    color: #4B0082;
    margin-bottom: 20px;
  }

  h3 {
    color: #4B0082;
    margin-bottom: 15px;
  }

  .jahr-select {
    padding: 8px 16px;
    border: 2px solid #667eea;
    border-radius: 6px;
    font-size: 15px;
    background: white;
    cursor: pointer;
    transition: border-color 0.2s ease;
  }

  .jahr-select:hover {
    border-color: #764ba2;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
    background-color: #F9F9FF;
    border-radius: 8px;
    overflow: hidden;
    margin-top: 20px;
  }
  
  .data-table th, .data-table td {
    padding: 12px 15px;
    text-align: center;
    border-bottom: 1px solid #DDD;
  }
  
  .data-table thead {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }
  
  .data-table tbody tr:nth-child(even) { 
    background-color: #F3F3FF; 
  }
  
  .data-table tbody tr:hover { 
    background-color: #EDE7FF; 
  }

  .edit-button {
    padding: 6px 12px;
    background-color: #4B0082;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 13px;
    transition: background-color 0.2s ease;
  }
  
  .edit-button:hover { 
    background-color: #6A0DAD; 
  }

  /* Statistik-Box */
  .stats-box {
    margin-top: 30px;
    padding: 25px;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-radius: 10px;
    border: 2px solid #667eea;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-top: 15px;
  }

  .stat-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .stat-label {
    font-size: 13px;
    color: #666;
    margin-bottom: 8px;
    font-weight: 600;
  }

  .stat-value {
    font-size: 18px;
    font-weight: 700;
    color: #4B0082;
  }

  .button-link {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    transition: all 0.2s ease;
    display: inline-block;
    margin: 0 5px;
  }
  
  .button-link:hover { 
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
  }

  .nav-links { 
    text-align: center; 
    margin-top: 30px; 
  }

  @media (max-width: 900px) {
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 600px) {
    .stats-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}
```

---

## **📋 WAS SICH ÄNDERT:**

### ✅ **Neue Features:**
1. **Jahr-Dropdown** (genau wie beim Diagramm)
2. **Jahr-Spalte** in der Tabelle (fett formatiert)
3. **Statistik-Box** am Ende mit:
   - Anzahl Einträge
   - Gesamt-Umsatz
   - Gesamt-Kosten
   - Gesamt-Gewinn
4. **Bessere Formatierung** mit Tausender-Trennzeichen

### ✅ **Filter funktioniert:**
- "Alle Jahre" → Zeigt alle Daten
- "2025" → Zeigt nur 2025
- "2026" → Zeigt nur 2026
- etc.

### ✅ **Statistik passt sich an:**
- Bei "Alle Jahre" → Gesamt-Statistik
- Bei "2025" → Nur Statistik für 2025

---

## **💡 BONUS: Statistik-Box erklärt**
```
┌─────────────────────────────────────────┐
│  Statistik (2025)                       │
├─────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐            │
│  │ Einträge │  │  Umsatz  │            │
│  │    12    │  │ 450k €   │            │
│  └──────────┘  └──────────┘            │
│                                         │
│  ┌──────────┐  ┌──────────┐            │
│  │  Kosten  │  │  Gewinn  │            │
│  │ 380k €   │  │ +70k €   │            │
│  └──────────┘  └──────────┘            │
└─────────────────────────────────────────┘